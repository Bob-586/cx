
/*!
 * routie - a tiny hash router
 * v0.3.2
 * http://projects.jga.me/routie
 * copyright Greg Allen 2013
 * MIT License
*/
(function(m){var n=[];var c={};var d="routie";var h=m[d];var j=function(p,o){this.name=o;this.path=p;this.keys=[];this.fns=[];this.params={};this.regex=e(this.path,this.keys,false,false)};j.prototype.addHandler=function(o){this.fns.push(o)};j.prototype.removeHandler=function(p){for(var o=0,r=this.fns.length;o<r;o++){var q=this.fns[o];if(p==q){this.fns.splice(o,1);return}}};j.prototype.run=function(p){for(var o=0,q=this.fns.length;o<q;o++){this.fns[o].apply(this,p)}};j.prototype.match=function(s,u){var p=this.regex.exec(s);if(!p){return false}for(var r=1,o=p.length;r<o;++r){var q=this.keys[r-1];var t=("string"==typeof p[r])?decodeURIComponent(p[r]):p[r];if(q){this.params[q.name]=t}u.push(t)}return true};j.prototype.toURL=function(q){var o=this.path;for(var p in q){o=o.replace("/:"+p,"/"+q[p])}o=o.replace(/\/:.*\?/g,"/").replace(/\?/g,"");if(o.indexOf(":")!=-1){throw new Error("missing parameters for url: "+o)}return o};var e=function(r,q,p,o){if(r instanceof RegExp){return r}if(r instanceof Array){r="("+r.join("|")+")"}r=r.concat(o?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(u,w,x,v,s,t){q.push({name:v,optional:!!t});w=w||"";return""+(t?"":w)+"(?:"+(t?w:"")+(x||"")+(s||(x&&"([^/.]+?)"||"([^/]+?)"))+")"+(t||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return new RegExp("^"+r+"$",p?"":"i")};var l=function(r,q){var p=r.split(" ");var o=(p.length==2)?p[0]:null;r=(p.length==2)?p[1]:p[0];if(!c[r]){c[r]=new j(r,o);n.push(c[r])}c[r].addHandler(q)};var b=function(r,o){if(typeof o=="function"){l(r,o);b.reload()}else{if(typeof r=="object"){for(var q in r){l(q,r[q])}b.reload()}else{if(typeof o==="undefined"){b.navigate(r)}}}};b.lookup=function(p,r){for(var q=0,s=n.length;q<s;q++){var o=n[q];if(o.name==p){return o.toURL(r)}}};b.remove=function(q,p){var o=c[q];if(!o){return}o.removeHandler(p)};b.removeAll=function(){c={};n=[]};b.navigate=function(q,p){p=p||{};var o=p.silent||false;if(o){f()}setTimeout(function(){window.location.hash=q;if(o){setTimeout(function(){a()},1)}},1)};b.noConflict=function(){m[d]=h;return b};var g=function(){return window.location.hash.substring(1)};var i=function(p,o){var q=[];if(o.match(p,q)){o.run(q);return true}return false};var k=b.reload=function(){var q=g();for(var p=0,r=n.length;p<r;p++){var o=n[p];if(i(q,o)){return}}};var a=function(){if(m.addEventListener){m.addEventListener("hashchange",k,false)}else{m.attachEvent("onhashchange",k)}};var f=function(){if(m.removeEventListener){m.removeEventListener("hashchange",k)}else{m.detachEvent("onhashchange",k)}};a();m[d]=b})(window);